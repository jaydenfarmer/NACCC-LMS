<div class="course-detail">
  @if (course(); as currentCourse) {
    <div class="course-header">
      <div class="breadcrumb">
        <a routerLink="/courses">‚Üê Back to Courses</a>
      </div>
      
      <div class="header-content">
        <div class="header-left">
          <span class="category-badge">{{ currentCourse.category }}</span>
          <h1>{{ currentCourse.title }}</h1>
          <p class="description">{{ currentCourse.description }}</p>
          
          <div class="course-meta">
            <div class="meta-item">
              <img [src]="currentCourse.instructor.avatar" [alt]="currentCourse.instructor.name" class="instructor-avatar" />
              <div>
                <div class="meta-label">Instructor</div>
                <div class="meta-value">{{ currentCourse.instructor.name }}</div>
              </div>
            </div>
            <div class="meta-item">
              <span class="meta-icon">‚≠ê</span>
              <div>
                <div class="meta-label">Rating</div>
                <div class="meta-value">{{ currentCourse.rating }}/5.0</div>
              </div>
            </div>
            <div class="meta-item">
              <span class="meta-icon">üë•</span>
              <div>
                <div class="meta-label">Students</div>
                <div class="meta-value">{{ currentCourse.enrolledCount }}</div>
              </div>
            </div>
            <div class="meta-item">
              <span class="meta-icon">‚è±Ô∏è</span>
              <div>
                <div class="meta-label">Duration</div>
                <div class="meta-value">{{ currentCourse.duration }} min</div>
              </div>
            </div>
          </div>

          @if (!isEnrolled()) {
            <button (click)="enroll()" class="btn-enroll">Enroll in Course</button>
          } @else {
            <div class="progress-section">
              <div class="progress-header">
                <span>Your Progress</span>
                <span class="progress-percentage">{{ progressPercentage() }}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="progressPercentage()"></div>
              </div>
              <div class="progress-stats">
                <span>{{ completedLessonsCount() }} of {{ totalLessons() }} lessons completed</span>
              </div>
            </div>
          }
        </div>
        
        <div class="header-right">
          <img [src]="currentCourse.thumbnail" [alt]="currentCourse.title" class="course-image" />
        </div>
      </div>
    </div>

    @if (isEnrolled()) {
      <div class="course-content">
        <div class="lessons-sidebar">
          <div class="sidebar-header">
            <h2>Course Content</h2>
            <div class="course-progress">{{ progressPercentage() }}% Complete</div>
          </div>
          
          <div class="modules-list">
            @for (module of modules(); track module.id) {
              <div class="module-section" [class.expanded]="module.isExpanded">
                <div class="module-header" (click)="toggleModule(module.id)">
                  <div class="module-left">
                    <span class="expand-icon">{{ module.isExpanded ? '‚ñº' : '‚ñ∂' }}</span>
                    <div class="module-info">
                      <div class="module-title">{{ module.title }}</div>
                      <div class="module-meta">
                        {{ module.lessons.length }} lessons ‚Ä¢ {{ getModuleProgress(module) }}% complete
                      </div>
                    </div>
                  </div>
                  <div class="module-progress-circle">
                    <svg width="32" height="32" viewBox="0 0 32 32">
                      <circle cx="16" cy="16" r="14" fill="none" stroke="#e5e7eb" stroke-width="3"/>
                      <circle 
                        cx="16" 
                        cy="16" 
                        r="14" 
                        fill="none" 
                        stroke="#2c5aa0" 
                        stroke-width="3"
                        stroke-dasharray="88"
                        [attr.stroke-dashoffset]="88 - (88 * getModuleProgress(module) / 100)"
                        stroke-linecap="round"
                        transform="rotate(-90 16 16)"
                      />
                    </svg>
                    <span class="progress-text">{{ getModuleProgress(module) }}%</span>
                  </div>
                </div>
                
                @if (module.isExpanded) {
                  <div class="lessons-list">
                    @for (lesson of module.lessons; track lesson.id) {
                      <div 
                        class="lesson-item"
                        [class.completed]="lesson.isCompleted"
                        [class.active]="selectedLesson()?.id === lesson.id"
                        (click)="selectLesson(lesson)"
                      >
                        <span class="lesson-icon">{{ getLessonIcon(lesson.type) }}</span>
                        <div class="lesson-info">
                          <div class="lesson-title">{{ lesson.title }}</div>
                          <div class="lesson-meta">
                            @if (lesson.duration) {
                              <span>{{ lesson.duration }} min</span>
                            }
                            <span class="lesson-type">{{ lesson.type }}</span>
                          </div>
                        </div>
                        @if (lesson.isCompleted) {
                          <span class="check-icon">‚úì</span>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <div class="player-area">
          @if (selectedLesson(); as lesson) {
            <div class="player">
              <h2>{{ lesson.title }}</h2>
              <p class="lesson-description">{{ lesson.description }}</p>
              
              @if (lesson.type === 'video') {
                <div class="video-container">
                  <iframe
                    [src]="lesson.content"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                  ></iframe>
                </div>
              } @else if (lesson.type === 'pdf') {
                <div class="pdf-container">
                  <div class="pdf-placeholder">
                    <span class="pdf-icon">üìÑ</span>
                    <h3>PDF Document</h3>
                    <p>{{ lesson.title }}</p>
                    <button class="btn-download">Download PDF</button>
                  </div>
                </div>
              } @else if (lesson.type === 'quiz') {
                <div class="quiz-container">
                  <div class="quiz-placeholder">
                    <span class="quiz-icon">‚úçÔ∏è</span>
                    <h3>Knowledge Check</h3>
                    <p>Test your understanding of the material</p>
                    <button class="btn-start-quiz">Start Quiz</button>
                  </div>
                </div>
              } @else if (lesson.type === 'exam') {
                <div class="exam-container">
                      <div class="exam-placeholder">
                        <span class="exam-icon">üìù</span>
                        <h3>Final Exam</h3>
                        <p>Complete this exam to earn your certificate</p>
                        <button [routerLink]="['/courses', currentCourse.id, 'lesson', lesson.id, 'exam']" class="btn-start-exam">Start Exam</button>
                      </div>
                </div>
              }

              <div class="lesson-actions">
                @if (!lesson.isCompleted) {
                  <button (click)="completeLesson()" class="btn-complete">
                    Mark as Complete
                  </button>
                } @else {
                  <div class="completed-badge">
                    ‚úì Completed
                  </div>
                }
              </div>
            </div>
          } @else {
            <div class="no-lesson-selected">
              <span class="icon">üìö</span>
              <h3>Select a lesson to begin</h3>
              <p>Choose a lesson from the sidebar to start learning</p>
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="not-enrolled">
        <h2>Course Curriculum</h2>
        <p>Enroll to access all course materials</p>
        <div class="curriculum-preview">
          @for (module of modules(); track module.id) {
            <div class="preview-module">
              <div class="preview-module-header">
                <span class="expand-icon">‚ñ∂</span>
                <div class="module-info">
                  <div class="module-title">{{ module.title }}</div>
                  <div class="module-meta">{{ module.lessons.length }} lessons</div>
                </div>
              </div>
              @for (lesson of module.lessons; track lesson.id) {
                <div class="preview-item">
                  <span class="lesson-icon">{{ getLessonIcon(lesson.type) }}</span>
                  <div class="preview-info">
                    <div class="preview-title">{{ lesson.title }}</div>
                    <div class="preview-meta">
                      {{ lesson.type }} ‚Ä¢ {{ lesson.duration }} min
                    </div>
                  </div>
                  <span class="lock-icon">üîí</span>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  } @else {
    <div class="loading">
      <h2>Course not found</h2>
      <a routerLink="/courses" class="btn-back">Back to Courses</a>
    </div>
  }
</div>
